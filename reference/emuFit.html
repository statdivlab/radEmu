<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Fit radEmu model"><title>Fit radEmu model — emuFit • radEmu</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fit radEmu model — emuFit"><meta property="og:description" content="Fit radEmu model"><meta property="og:image" content="https://statdivlab.github.io/radEmu/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">radEmu</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/intro_radEmu_with_phyloseq.html">Introduction to radEmu with phyloseq</a>
    <a class="dropdown-item" href="../articles/intro_radEmu.html">Introduction to radEmu</a>
    <a class="dropdown-item" href="../articles/parallel_radEmu.html">Parallelizing computation for score tests with radEmu</a>
    <a class="dropdown-item" href="../articles/radEmu_clustered_data.html">Using radEmu on clustered data</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/statdivlab/radEmu/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Fit radEmu model</h1>
      <small class="dont-index">Source: <a href="https://github.com/statdivlab/radEmu/blob/HEAD/R/emuFit.R" class="external-link"><code>R/emuFit.R</code></a></small>
      <div class="d-none name"><code>emuFit.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Fit radEmu model</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">emuFit</span><span class="op">(</span></span>
<span>  <span class="va">Y</span>,</span>
<span>  X <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  formula <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cluster <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  penalize <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  B <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  B_null_list <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fitted_model <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  refit <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  test_kj <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  return_wald_p <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  compute_cis <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  run_score_tests <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  use_fullmodel_info <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  use_fullmodel_cov <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  use_both_cov <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  constraint_fn <span class="op">=</span> <span class="va">pseudohuber_center</span>,</span>
<span>  constraint_grad_fn <span class="op">=</span> <span class="va">dpseudohuber_center_dx</span>,</span>
<span>  constraint_param <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  tolerance <span class="op">=</span> <span class="fl">1e-04</span>,</span>
<span>  B_null_tol <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>  rho_init <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  inner_tol <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  ntries <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  tau <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  kappa <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  constraint_tol <span class="op">=</span> <span class="fl">1e-05</span>,</span>
<span>  c1 <span class="op">=</span> <span class="fl">1e-04</span>,</span>
<span>  maxit <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  inner_maxit <span class="op">=</span> <span class="fl">25</span>,</span>
<span>  max_step <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  trackB <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  return_nullB <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  return_both_score_pvals <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>Y</dt>
<dd><p>an n x J matrix or dataframe of nonnegative observations, or a phyloseq object containing an otu table and sample data.</p></dd>


<dt>X</dt>
<dd><p>an n x p matrix or dataframe of covariates (optional)</p></dd>


<dt>formula</dt>
<dd><p>a one-sided formula specifying the form of the mean model to be fit</p></dd>


<dt>data</dt>
<dd><p>an n x p data frame containing variables given in <code>formula</code></p></dd>


<dt>cluster</dt>
<dd><p>a vector giving cluster membership for each row of Y to be used in computing
GEE test statistics. Default is NULL, in which case rows of Y are treated as independent.</p></dd>


<dt>penalize</dt>
<dd><p>logical: should Firth penalty be used in fitting model? Default is TRUE.</p></dd>


<dt>B</dt>
<dd><p>starting value of coefficient matrix (p x J). If not provided,
B will be initiated as a zero matrix.</p></dd>


<dt>B_null_list</dt>
<dd><p>list of starting values of coefficient matrix (p x J) for null estimation. This should either
be a list with the same length as <code>test_kj</code>. If you only want to provide starting values for some tests,
include the other elements of the list as <code>NULL</code>.</p></dd>


<dt>fitted_model</dt>
<dd><p>a fitted model produced by a separate call to emuFit; to
be provided if score tests are to be run without refitting the full unrestricted model.
Default is NULL.</p></dd>


<dt>refit</dt>
<dd><p>logical: if B or fitted_model is provided, should full model be fit (TRUE) or
should fitting step be skipped (FALSE), e.g., if score tests are to be run on an already
fitted model. Default is TRUE.</p></dd>


<dt>test_kj</dt>
<dd><p>a data frame whose rows give coordinates (in category j and
covariate k) of elements of B to construct hypothesis tests for. If <code>test_kj</code>
is not provided, all elements of B save the intercept row will be tested.</p></dd>


<dt>alpha</dt>
<dd><p>nominal type 1 error level to be used to construct confidence intervals. Default is 0.05
(corresponding to 95% confidence intervals)</p></dd>


<dt>return_wald_p</dt>
<dd><p>logical: return p-values from Wald tests? Default is FALSE.</p></dd>


<dt>compute_cis</dt>
<dd><p>logical: compute and return Wald CIs? Default is TRUE.</p></dd>


<dt>run_score_tests</dt>
<dd><p>logical: perform robust score testing? Default is TRUE.</p></dd>


<dt>use_fullmodel_info</dt>
<dd><p>logical: TODO? Default is FALSE.</p></dd>


<dt>use_fullmodel_cov</dt>
<dd><p>logical: use information matrix and empirical score covariance
computed for full model fit? Defaults to FALSE, in which case these quantities are
recomputed for each null model fit for score testing.</p></dd>


<dt>use_both_cov</dt>
<dd><p>logical: should score tests be run using information and
empirical score covariance evaluated both under the null and full models?
Used in simulations</p></dd>


<dt>constraint_fn</dt>
<dd><p>function g defining a constraint on rows of B; g(B_k) = 0
for rows k = 1, ..., p of B. Default function is a smoothed median (minimizer of
pseudohuber loss).</p></dd>


<dt>constraint_grad_fn</dt>
<dd><p>derivative of constraint_fn with respect to its
arguments (i.e., elements of a row of B)</p></dd>


<dt>constraint_param</dt>
<dd><p>If pseudohuber centering is used (this is the default),
parameter controlling relative weighting of elements closer and further from center.
(Limit as <code>constraint_param</code> approaches infinity is the mean; as this parameter approaches zero,
the minimizer of the pseudo-Huber loss approaches the median.)</p></dd>


<dt>verbose</dt>
<dd><p>provide updates as model is being fitted? Defaults to TRUE.</p></dd>


<dt>tolerance</dt>
<dd><p>tolerance for stopping criterion in full model fitting; once
no element of B is updated by more than this value in a single step, we exit
optimization. Defaults to 1e-3.</p></dd>


<dt>B_null_tol</dt>
<dd><p>numeric: convergence tolerance for null model fits for score testing (if max of absolute difference in
B across outer iterations is below this threshold, we declare convergence).
Default is 0.01.</p></dd>


<dt>rho_init</dt>
<dd><p>numeric: value at which to initiate rho parameter in augmented Lagrangian
algorithm. Default is 1.</p></dd>


<dt>inner_tol</dt>
<dd><p>numeric: convergence tolerance for augmented Lagrangian subproblems
within null model fitting. Default is 1.</p></dd>


<dt>ntries</dt>
<dd><p>numeric: how many times should optimization be tried in null
models where at least one optimization attempt fails? Default is 4.</p></dd>


<dt>tau</dt>
<dd><p>numeric: value to scale rho by in each iteration of augmented Lagrangian
algorithm that does not move estimate toward zero sufficiently. Default is 2.</p></dd>


<dt>kappa</dt>
<dd><p>numeric: value between 0 and 1 that determines the cutoff on the ratio
of current distance from feasibility over distance in last iteration triggering
scaling of rho. If this ratio is above kappa, rho is scaled by tau to encourage
estimate to move toward feasibility.</p></dd>


<dt>constraint_tol</dt>
<dd><p>numeric: constraint tolerance for fits under null hypotheses
(tested element of B must be equal to constraint function to within this tolerance for
a fit to be accepted as a solution to constrained optimization problem). Default is 1e-5.</p></dd>


<dt>c1</dt>
<dd><p>numeric: parameter for Armijo line search. Default is 1e-4.</p></dd>


<dt>maxit</dt>
<dd><p>maximum number of outer iterations of augmented lagrangian algorithm to perform before
exiting optimization. Default is 1000.</p></dd>


<dt>inner_maxit</dt>
<dd><p>maximum number of coordinate descent passes through columns of B to make within each
outer iteration of augmented lagrangian algorithm before exiting inner loop</p></dd>


<dt>max_step</dt>
<dd><p>maximum stepsize; update directions computed during optimization
will be rescaled if a step in any parameter exceeds this value. Defaults to 0.5.</p></dd>


<dt>trackB</dt>
<dd><p>logical: should values of B be recorded across optimization
iterations and be returned? Primarily used for debugging. Default is FALSE.</p></dd>


<dt>return_nullB</dt>
<dd><p>logical: should values of B under null hypothesis be returned. Primarily used for debugging. Default is FALSE.</p></dd>


<dt>return_both_score_pvals</dt>
<dd><p>logical: should score p-values be returned using both
information matrix computed from full model fit and from null model fits? Default is
FALSE. This parameter is used for simulations - in any applied analysis, type of
p-value to be used should be chosen before conducting tests.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A list containing elements 'coef', 'B', 'penalized', 'Y_augmented',
'I', 'Dy', and 'score_test_hyperparams' if score tests are run.  Parameter estimates by
covariate and outcome category (e.g., taxon for microbiome data), as well as
optionally confidence intervals and p-values, are contained in 'coef'. 'B'
contains parameter estimates in matrix format (rows indexing covariates and
columns indexing outcome category / taxon). 'penalized' is equal to TRUE
if Firth penalty is used in estimation (default) and FALSE otherwise. 'I' and
'Dy' contain an information matrix and empirical score covariance matrix
computed under the full model. 'score_test_hyperparams' contains parameters and
hyperparameters related to estimation under the null, including whether or not the
algorithm converged, which can be helpful for debugging.</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Clausen, Amy Willis, Sarah Teichman.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

