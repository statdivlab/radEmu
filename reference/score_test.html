<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Run robust score test"><title>Run robust score test — score_test • radEmu</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Run robust score test — score_test"><meta property="og:description" content="Run robust score test"><meta property="og:image" content="https://statdivlab.github.io/radEmu/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">radEmu</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/intro_radEmu_with_phyloseq.html">Introduction to radEmu with phyloseq</a>
    <a class="dropdown-item" href="../articles/intro_radEmu.html">Introduction to radEmu</a>
    <a class="dropdown-item" href="../articles/parallel_radEmu.html">Parallelizing computation for score tests with radEmu</a>
    <a class="dropdown-item" href="../articles/radEmu_clustered_data.html">Using radEmu on clustered data</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/statdivlab/radEmu/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Run robust score test</h1>
      <small class="dont-index">Source: <a href="https://github.com/statdivlab/radEmu/blob/HEAD/R/score_test.R" class="external-link"><code>R/score_test.R</code></a></small>
      <div class="d-none name"><code>score_test.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Run robust score test</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">score_test</span><span class="op">(</span></span>
<span>  <span class="va">B</span>,</span>
<span>  <span class="va">Y</span>,</span>
<span>  <span class="va">X</span>,</span>
<span>  <span class="va">X_cup</span>,</span>
<span>  <span class="va">k_constr</span>,</span>
<span>  <span class="va">j_constr</span>,</span>
<span>  <span class="va">constraint_fn</span>,</span>
<span>  <span class="va">constraint_grad_fn</span>,</span>
<span>  rho_init <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  tau <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  kappa <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  B_tol <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>  inner_tol <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  constraint_tol <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>  <span class="va">j_ref</span>,</span>
<span>  c1 <span class="op">=</span> <span class="fl">1e-04</span>,</span>
<span>  maxit <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  inner_maxit <span class="op">=</span> <span class="fl">25</span>,</span>
<span>  ntries <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  trackB <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  I_inv <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  Dy <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  return_both_score_pvals <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  cluster <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>B</dt>
<dd><p>value of coefficient matrix (p x J) returned by full model fit or value of coefficient
matrix to start null estimation at given as input to emuFit</p></dd>


<dt>Y</dt>
<dd><p>an n x J matrix or dataframe of <em>augmented</em> nonnegative observations (i.e.,
observations Y plus augmentations from last iteration of maximum penalized likelihood estimation
for full model)</p></dd>


<dt>X</dt>
<dd><p>an n x p matrix of covariates</p></dd>


<dt>X_cup</dt>
<dd><p>the design matrix for long format Y in long format B (nJ x pJ)</p></dd>


<dt>k_constr</dt>
<dd><p>row index of element of B to be tested for equality to row identifiability constraint</p></dd>


<dt>j_constr</dt>
<dd><p>column index of element of B to be tested for equality to row identifiability constraint</p></dd>


<dt>constraint_fn</dt>
<dd><p>function g defining a constraint on rows of B; g(B_k) = 0
for rows k = 1, ..., p of B. Default function is a smoothed median (minimizer of
pseudohuber loss).</p></dd>


<dt>constraint_grad_fn</dt>
<dd><p>function returning gradient of constraint function (as
a function of a row of B)</p></dd>


<dt>rho_init</dt>
<dd><p>numeric: value at which to initiate rho parameter in augmented Lagrangian
algorithm. Default is 1.</p></dd>


<dt>tau</dt>
<dd><p>numeric: value to scale rho by in each iteration of augmented Lagrangian
algorithm that does not move estimate toward zero sufficiently. Default is 2.</p></dd>


<dt>kappa</dt>
<dd><p>numeric: value between 0 and 1 that determines the cutoff on the ratio
of current distance from feasibility over distance in last iteration triggering
scaling of rho. If this ratio is above kappa, rho is scaled by tau to encourage
estimate to move toward feasibility.</p></dd>


<dt>B_tol</dt>
<dd><p>numeric: convergence tolerance for null model fits for score testing (if max of absolute difference in
B across outer iterations is below this threshold, we declare convergence).
Default is 0.001.</p></dd>


<dt>inner_tol</dt>
<dd><p>numeric: convergence tolerance for inner loop of null fitting algorithm (if max of absolute difference in
B across inner iterations is below this threshold, we declare convergence).
Default is 0.01.</p></dd>


<dt>constraint_tol</dt>
<dd><p>numeric: constraint tolerance for fits under null hypotheses
(tested element of B must be equal to constraint function to within this tolerance for
a fit to be accepted as a solution to constrained optimization problem). Default is 1e-5.</p></dd>


<dt>j_ref</dt>
<dd><p>column index of convenience constraint</p></dd>


<dt>c1</dt>
<dd><p>numeric: parameter for Armijo line search. Default is 1e-4.</p></dd>


<dt>maxit</dt>
<dd><p>maximum number of outer iterations of augmented lagrangian algorithm to perform before
exiting optimization. Default is 1000.</p></dd>


<dt>inner_maxit</dt>
<dd><p>maximum number of coordinate descent passes through columns of B to make within each
outer iteration of augmented lagrangian algorithm before exiting inner loop</p></dd>


<dt>ntries</dt>
<dd><p>numeric: total number of times to attempt optimization under null
if optimization fails (optimization parameters will be tweaked in subsequent
fits to attempt to avoid failure). Default is 4.</p></dd>


<dt>verbose</dt>
<dd><p>provide updates as model is being fitted? Defaults to TRUE.</p></dd>


<dt>trackB</dt>
<dd><p>store and return values of B at each iteration of optimization
algorithm? Useful for debugging. Default is FALSE.</p></dd>


<dt>I_inv</dt>
<dd><p>Optional: matrix containing inverted information matrix computed
under full model. Default is NULL, in which case information is recomputed under
null, which we recommend.</p></dd>


<dt>Dy</dt>
<dd><p>Optional: matrix containing empirical score covariance computed
under full model. Default is NULL, in which case this quantity is recomputed
under null, which we recommend.</p></dd>


<dt>return_both_score_pvals</dt>
<dd><p>logical: should score p-values be returned using both
information matrix computed from full model fit and from null model fits? Default is
FALSE. This parameter is used for simulations - in any applied analysis, type of
p-value to be used should be chosen before conducting tests.</p></dd>


<dt>cluster</dt>
<dd><p>a numeric vector giving cluster membership for each row of Y to
be used in computing GEE test statistics. Default is NULL, in which case rows of
Y are treated as independent.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A list containing elements 'score_stat', 'pval', 'log_pval','niter',
'convergence', 'gap', 'u', 'rho', 'tau', 'inner_maxit', 'null_B', and 'Bs'. 'score_stat' gives the
value of the robust score statistic for H_0: B_k_constr,j_constr = g(B_k_constr).
'pval' and 'log_pval' are the p-value (on natural and log scales) corresponding to
the score statistic (log_pval may be useful when the p-value is very close to zero).
'gap' is the final value of g(B_k_constr) - B_k_constr, j_constr obtained in
optimization under the null. 'u' and 'rho' are final values of augmented
Lagrangian parameters returned by null fitting algorithm. 'tau' is the final value of 'tau' that
is used to update the 'rho' values and 'inner_maxit' is the final maximum number of iterations for
the inner optimization loop in optimization under the null, in which B and z parameter values are
maximized for specific 'u' and 'rho' parameters. 'null_B' is the value of
B returned but the null fitting algorithm. 'Bs' is by default NULL; if trackB = TRUE,
'Bs is a data frame containing values of B by outcome category, covariate, and
iteration.</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Clausen, Amy Willis, Sarah Teichman.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

