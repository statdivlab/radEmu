<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using radEmu with a reference taxon • radEmu</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using radEmu with a reference taxon">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">radEmu</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/intro_radEmu_with_phyloseq.html">Introduction to radEmu with phyloseq</a></li>
    <li><a class="dropdown-item" href="../articles/intro_radEmu_with_tse.html">Introduction to radEmu with TreeSummarizedExperiment</a></li>
    <li><a class="dropdown-item" href="../articles/intro_radEmu.html">Introduction to radEmu</a></li>
    <li><a class="dropdown-item" href="../articles/parallel_radEmu.html">Parallelizing computation for score tests with radEmu</a></li>
    <li><a class="dropdown-item" href="../articles/radEmu_clustered_data.html">Using radEmu on clustered data</a></li>
    <li><a class="dropdown-item" href="../articles/radEmu_with_reference_taxon.html">Using radEmu with a reference taxon</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/statdivlab/radEmu/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Using radEmu with a reference taxon</h1>
                        <h4 data-toc-skip class="author">Sarah Teichman
and Amy Willis</h4>
            
            <h4 data-toc-skip class="date">2025-03-14</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/statdivlab/radEmu/blob/main/vignettes/radEmu_with_reference_taxon.Rmd" class="external-link"><code>vignettes/radEmu_with_reference_taxon.Rmd</code></a></small>
      <div class="d-none name"><code>radEmu_with_reference_taxon.Rmd</code></div>
    </div>

    
    
<p>First, we will install <code>radEmu</code>, if we haven’t
already.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># if (!require("remotes", quietly = TRUE))</span></span>
<span><span class="co">#     install.packages("remotes")</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># remotes::install_github("statdivlab/radEmu")</span></span></code></pre></div>
<p>Next, we can load <code>radEmu</code> as well as the
<code>tidyverse</code> package suite.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/statdivlab/radEmu" class="external-link">radEmu</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this vignette, we will use <code>radEmu</code> with a reference
taxon as the identifiability constraint, instead of
<code>radEmu</code>’s default of using the “typical” log fold-difference
across taxa as the identifiability constraint. This is useful if you
have a specific taxon that you want to compare all other taxa to, or if
your experimental design includes a spiked-in synthetic taxon or
internal standard. In this vignette we will provide an example of
setting a reference taxon, and discuss how this changes the
interpretation of <code>radEmu</code> parameter estimates and test
results. This vignette assumes familiarity with the basic usage of
<code>radEmu</code>, and we suggest reviewing the “intro_radEmu.Rmd”
vignette before working through this vignette.</p>
</div>
<div class="section level2">
<h2 id="loading-and-preparing-data">Loading and preparing data<a class="anchor" aria-label="anchor" href="#loading-and-preparing-data"></a>
</h2>
<p>We’ll use a <a href="https://www.nature.com/articles/s41591-019-0406-6" class="external-link">dataset
published by Wirbel et al. (2019)</a>, see “intro_radEmu.Rmd” for more
information about this data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"wirbel_sample"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"wirbel_otu"</span><span class="op">)</span></span>
<span><span class="va">mOTU_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">wirbel_otu</span><span class="op">)</span></span></code></pre></div>
<p>We will now prepare this data to obtain our abundance table and
covariate data to use with <code>emuFit</code>. Again, see
“intro_radEmu.Rmd” for an explanation of each of the steps in the code
below.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wirbel_sample</span><span class="op">$</span><span class="va">Group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">wirbel_sample</span><span class="op">$</span><span class="va">Group</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CTR"</span>,<span class="st">"CRC"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">chosen_genera</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Eubacterium"</span>, <span class="st">"Faecalibacterium"</span>, <span class="st">"Fusobacterium"</span>, <span class="st">"Porphyromonas"</span><span class="op">)</span></span>
<span><span class="va">mOTU_name_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>name <span class="op">=</span> <span class="va">mOTU_names</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>base_name <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove</a></span><span class="op">(</span><span class="va">mOTU_names</span>, <span class="st">"unknown "</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                      <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove</a></span><span class="op">(</span><span class="st">"uncultured "</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>genus_name <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/word.html" class="external-link">word</a></span><span class="op">(</span><span class="va">base_name</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">restricted_mOTU_names</span> <span class="op">&lt;-</span> <span class="va">mOTU_name_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">genus_name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">chosen_genera</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ch_study_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">wirbel_sample</span><span class="op">$</span><span class="va">Country</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CHI"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">small_Y</span> <span class="op">&lt;-</span> <span class="va">wirbel_otu</span><span class="op">[</span><span class="va">ch_study_obs</span>, <span class="va">restricted_mOTU_names</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums-methods.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">small_Y</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="co"># no samples have a count sum of 0 </span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums-methods.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">small_Y</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="co"># one category has a count sum of 0</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span></span>
<span><span class="va">category_to_rm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums-methods.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">small_Y</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">small_Y</span> <span class="op">&lt;-</span> <span class="va">small_Y</span><span class="op">[</span>, <span class="op">-</span><span class="va">category_to_rm</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums-methods.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">small_Y</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fitting-a-model">Fitting a model<a class="anchor" aria-label="anchor" href="#fitting-a-model"></a>
</h2>
<p>Now we will use the function <code><a href="../reference/emuFit.html">emuFit()</a></code> to fit our model.
We will start by fitting <code>radEmu</code>’s default model, which uses
the “typical” log fold-difference across taxa as the identifiability
constraint.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ch_fit_default</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emuFit.html">emuFit</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="op">~</span> <span class="va">Group</span>, </span>
<span>                         data <span class="op">=</span> <span class="va">wirbel_sample</span><span class="op">[</span><span class="va">ch_study_obs</span>, <span class="op">]</span>,</span>
<span>                         Y <span class="op">=</span> <span class="va">small_Y</span>,</span>
<span>                         run_score_tests <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </span></code></pre></div>
<p>Let’s look at the first few estimates.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ch_fit_default</span><span class="op">$</span><span class="va">coef</span><span class="op">)</span></span>
<span><span class="co">#&gt;   covariate                                                category</span></span>
<span><span class="co">#&gt; 1  GroupCRC Fusobacterium nucleatum s. vincentii [ref_mOTU_v2_0754]</span></span>
<span><span class="co">#&gt; 2  GroupCRC  Fusobacterium nucleatum s. animalis [ref_mOTU_v2_0776]</span></span>
<span><span class="co">#&gt; 3  GroupCRC Fusobacterium nucleatum s. nucleatum [ref_mOTU_v2_0777]</span></span>
<span><span class="co">#&gt; 4  GroupCRC         Faecalibacterium prausnitzii [ref_mOTU_v2_1379]</span></span>
<span><span class="co">#&gt; 5  GroupCRC                  Eubacterium siraeum [ref_mOTU_v2_1387]</span></span>
<span><span class="co">#&gt; 6  GroupCRC                      Eubacterium sp. [ref_mOTU_v2_1395]</span></span>
<span><span class="co">#&gt;   category_num    estimate        se      lower     upper score_stat pval</span></span>
<span><span class="co">#&gt; 1            1  1.48637864 0.8966329 -0.2709896 3.2437469         NA   NA</span></span>
<span><span class="co">#&gt; 2            2  2.31317105 0.8271200  0.6920456 3.9342966         NA   NA</span></span>
<span><span class="co">#&gt; 3            3  3.08640472 1.0275200  1.0725026 5.1003069         NA   NA</span></span>
<span><span class="co">#&gt; 4            4 -0.34307573 0.3520406 -1.0330626 0.3469111         NA   NA</span></span>
<span><span class="co">#&gt; 5            5  0.03892098 0.4780368 -0.8980140 0.9758559         NA   NA</span></span>
<span><span class="co">#&gt; 6            6  1.12952354 0.9563470 -0.7448821 3.0039292         NA   NA</span></span></code></pre></div>
<p>The first taxon reported is <em>F. nucleatum s. vincentii</em>, and
it has an “estimate” of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1.49</mn><annotation encoding="application/x-tex">1.49</annotation></semantics></math>.
This means that the abundance of <em>F. nucleatum s. vincentii</em> is,
on average,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>e</mi><mn>1.49</mn></msup><mo>=</mo><mn>4.4</mn></mrow><annotation encoding="application/x-tex">e^{1.49}=4.4</annotation></semantics></math>
times greater in colorectal cancer cases compared to controls compared
to the typical fold-difference of taxa in cases compared to
controls.</p>
<p>Let’s look at the distribution of log fold-difference estimates.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ch_fit_default</span><span class="op">$</span><span class="va">coef</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<p><img src="radEmu_with_reference_taxon_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>We can see that the log fold-difference estimates in this analysis
range from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mo>−</mo><mn>2.5</mn></mrow><annotation encoding="application/x-tex">\approx -2.5</annotation></semantics></math>
to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mn>6.5</mn></mrow><annotation encoding="application/x-tex">\approx 6.5</annotation></semantics></math>.
Furthermore, the median log fold-difference is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\approx 0</annotation></semantics></math>,
which is a consequence of the default identifability constraint… and why
we need to add “compared to the typical fold-difference of taxa in cases
compared to controls” in the above interpretation. (Yes, it’s annoying…
but it’s necessary to avoid making stronger assumptions.)</p>
<p>Now, we will instead use a <strong>reference taxon</strong> to give
the identifiability constraint. Here’s <del>two</del> three scenarios
where this might be useful:</p>
<ol style="list-style-type: decimal">
<li>You know that a taxon is not changing in average abundance across
your comparison groups. Maybe you’ve looked at comparable datasets, or
maybe you know this mechanistically given the system you’re studying.
Either way, you know it.</li>
<li>You spiked a taxon at equal abundance into your samples. So, you
know it’s not changing in average abundance across your comparison
groups. (This is just #1, but you made it happen. Go you!)</li>
<li>You just want to compare the fold-differences in abundance to a
specific taxon’s fold-difference in abundance, without assuming that
this taxon is not different in average abundance.</li>
</ol>
<p><em>Note:</em> Setting 3 isn’t different from 1 or 2 in its code, but
the interpretations of estimates and inference will be different – with
the comparison looking more like the median-comparison, but now with a
taxon-specific comparison.</p>
<p>Let’s suppose you’re in Setting 1 or 2, and that <em>F. nucleatum s.
animalis</em> is that taxon.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ref_taxon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">small_Y</span><span class="op">)</span>, <span class="st">"Fusobacterium nucleatum s. animalis"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ref_taxon</span> <span class="co"># the index of F. nucleatum s. animalis in our Y matrix</span></span>
<span><span class="co">#&gt; [1] 2</span></span></code></pre></div>
<p>To use that taxon index as the reference, just pass its column index
to <code>constraint_fn</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ch_fit_ref</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emuFit.html">emuFit</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="op">~</span> <span class="va">Group</span>, </span>
<span>                     data <span class="op">=</span> <span class="va">wirbel_sample</span><span class="op">[</span><span class="va">ch_study_obs</span>, <span class="op">]</span>,</span>
<span>                     Y <span class="op">=</span> <span class="va">small_Y</span>,</span>
<span>                     run_score_tests <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                     constraint_fn <span class="op">=</span> <span class="va">ref_taxon</span><span class="op">)</span> </span></code></pre></div>
<p>Again, let’s look at the first few estimates.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ch_fit_ref</span><span class="op">$</span><span class="va">coef</span><span class="op">)</span></span>
<span><span class="co">#&gt;   covariate                                                category</span></span>
<span><span class="co">#&gt; 1  GroupCRC Fusobacterium nucleatum s. vincentii [ref_mOTU_v2_0754]</span></span>
<span><span class="co">#&gt; 2  GroupCRC  Fusobacterium nucleatum s. animalis [ref_mOTU_v2_0776]</span></span>
<span><span class="co">#&gt; 3  GroupCRC Fusobacterium nucleatum s. nucleatum [ref_mOTU_v2_0777]</span></span>
<span><span class="co">#&gt; 4  GroupCRC         Faecalibacterium prausnitzii [ref_mOTU_v2_1379]</span></span>
<span><span class="co">#&gt; 5  GroupCRC                  Eubacterium siraeum [ref_mOTU_v2_1387]</span></span>
<span><span class="co">#&gt; 6  GroupCRC                      Eubacterium sp. [ref_mOTU_v2_1395]</span></span>
<span><span class="co">#&gt;   category_num   estimate        se     lower       upper score_stat pval</span></span>
<span><span class="co">#&gt; 1            1 -0.8267924 0.4581980 -1.724844  0.07125911         NA   NA</span></span>
<span><span class="co">#&gt; 2            2  0.0000000 0.0000000  0.000000  0.00000000         NA   NA</span></span>
<span><span class="co">#&gt; 3            3  0.7732337 0.6760617 -0.551823  2.09829032         NA   NA</span></span>
<span><span class="co">#&gt; 4            4 -2.6562468 0.8743699 -4.369980 -0.94251329         NA   NA</span></span>
<span><span class="co">#&gt; 5            5 -2.2742501 1.0331042 -4.299097 -0.24940312         NA   NA</span></span>
<span><span class="co">#&gt; 6            6 -1.1836475 1.1805958 -3.497573  1.13027766         NA   NA</span></span></code></pre></div>
<p>First, note that the estimate for <em>F. nucleatum s. animalis</em>
is now
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0</mn><annotation encoding="application/x-tex">0</annotation></semantics></math>,
because we have set it as the reference taxon. Great. It did what it was
told.</p>
<p>The estimate for <em>F. nucleatum s. vincentii</em> is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mn>0.83</mn></mrow><annotation encoding="application/x-tex">-0.83</annotation></semantics></math>.
The interpretation of this estimate <em>under Setting 1 or 2</em> is
that the average abundance of <em>F. nucleatum s. vincentii</em> in
cancer cases is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mi>x</mi><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>−</mo><mn>0.83</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>0.44</mn></mrow><annotation encoding="application/x-tex">exp(-0.83) = 0.44</annotation></semantics></math>
times that of non-cancer controls. Alternatively, its average abundance
is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mi>x</mi><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0.83</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>2.29</mn></mrow><annotation encoding="application/x-tex">exp(0.83) = 2.29</annotation></semantics></math>
times greater in non-cancer controls compared to cases.</p>
<p>How did this work? Because we assumed/knew information about one
taxon, we could “pin down” the location of all estimates. Cool!</p>
<p>If we were instead in Setting 3, our interpretation would be slightly
different. In this setting, the fold-difference in average abundance of
<em>F. nucleatum s. vincentii</em> in cancer cases compared to
non-cancer controls is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mi>x</mi><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>−</mo><mn>0.83</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>0.44</mn></mrow><annotation encoding="application/x-tex">exp(-0.83) = 0.44</annotation></semantics></math>
times the fold-difference in average abundance of <em>F. nucleatum s.
animalis</em> in cases compared to controls.</p>
<p>Let’s look at the distribution of log fold-difference estimates.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ch_fit_ref</span><span class="op">$</span><span class="va">coef</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<p><img src="radEmu_with_reference_taxon_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>Here, we can see a distribution that has the same shape as the
distribution of estimates when using the default constraint. This is
because the result of changing the identifiability constraint is to
shift all estimates up or down by the same value, where this value is
determined by the constraint. In this plot, the log fold-difference
estimates range from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mo>−</mo><mn>4.5</mn></mrow><annotation encoding="application/x-tex">\approx -4.5</annotation></semantics></math>
to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">\approx 4</annotation></semantics></math>,
and the median log fold-difference is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mo>−</mo><mn>2.5</mn></mrow><annotation encoding="application/x-tex">\approx -2.5</annotation></semantics></math>.
This shows that while the majority of taxa have ratios of average
abundances of cases to controls that are smaller than that of <em>F.
nucleatum s. animalis</em>, there are some taxa that have larger ratios
and are even more enriched in cases compared to controls than our chosen
reference taxon.</p>
</div>
<div class="section level2">
<h2 id="hypothesis-testing">Hypothesis testing<a class="anchor" aria-label="anchor" href="#hypothesis-testing"></a>
</h2>
<p>Finally, let’s test hypotheses about the taxon <em>F. nucleatum s.
vincentii</em> using both identifiability constraints. First consider
the default constraint. We will run a robust score test.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ch_test_default</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emuFit.html">emuFit</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="op">~</span> <span class="va">Group</span>, </span>
<span>                         data <span class="op">=</span> <span class="va">wirbel_sample</span><span class="op">[</span><span class="va">ch_study_obs</span>, <span class="op">]</span>,</span>
<span>                         Y <span class="op">=</span> <span class="va">small_Y</span>,</span>
<span>                         fitted_model <span class="op">=</span> <span class="va">ch_fit_default</span>, <span class="co"># provide our previous fit</span></span>
<span>                         refit <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># avoid refitting model</span></span>
<span>                         <span class="co"># test the first taxon, F. nucleatum s. vincentii</span></span>
<span>                         test_kj <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>j <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                         <span class="co"># test the second column in the design matrix</span></span>
<span>                         <span class="co"># associated with the case/control covariate</span></span>
<span>                                              k <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<p>Now let’s look at the results.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ch_test_default</span><span class="op">$</span><span class="va">coef</span><span class="op">)</span></span>
<span><span class="co">#&gt;   covariate                                                category</span></span>
<span><span class="co">#&gt; 1  GroupCRC Fusobacterium nucleatum s. vincentii [ref_mOTU_v2_0754]</span></span>
<span><span class="co">#&gt; 2  GroupCRC  Fusobacterium nucleatum s. animalis [ref_mOTU_v2_0776]</span></span>
<span><span class="co">#&gt; 3  GroupCRC Fusobacterium nucleatum s. nucleatum [ref_mOTU_v2_0777]</span></span>
<span><span class="co">#&gt; 4  GroupCRC         Faecalibacterium prausnitzii [ref_mOTU_v2_1379]</span></span>
<span><span class="co">#&gt; 5  GroupCRC                  Eubacterium siraeum [ref_mOTU_v2_1387]</span></span>
<span><span class="co">#&gt; 6  GroupCRC                      Eubacterium sp. [ref_mOTU_v2_1395]</span></span>
<span><span class="co">#&gt;   category_num    estimate        se      lower     upper score_stat      pval</span></span>
<span><span class="co">#&gt; 1            1  1.48637864 0.8966329 -0.2709896 3.2437469   4.245038 0.0393652</span></span>
<span><span class="co">#&gt; 2            2  2.31317105 0.8271200  0.6920456 3.9342966         NA        NA</span></span>
<span><span class="co">#&gt; 3            3  3.08640472 1.0275200  1.0725026 5.1003069         NA        NA</span></span>
<span><span class="co">#&gt; 4            4 -0.34307573 0.3520406 -1.0330626 0.3469111         NA        NA</span></span>
<span><span class="co">#&gt; 5            5  0.03892098 0.4780368 -0.8980140 0.9758559         NA        NA</span></span>
<span><span class="co">#&gt; 6            6  1.12952354 0.9563470 -0.7448821 3.0039292         NA        NA</span></span></code></pre></div>
<p>We have a p-value of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.039</mn><annotation encoding="application/x-tex">0.039</annotation></semantics></math>.
This means that with an alpha level of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.05</mn><annotation encoding="application/x-tex">0.05</annotation></semantics></math>,
we reject the null hypothesis that the expected log fold-difference in
abundance of <em>F. nucleatum s. vincentii</em> in cases compared to
controls is equal to the typical log fold-difference in abundance of
cases to controls across all taxa in the analysis. We conclude that
<em>F. nucleatum s. vincentii</em> is enriched in cases compared to
controls, relative to the typical taxon in the analysis.</p>
<p>Now, instead consider a test using our reference taxon
constraint.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ch_test_ref</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/emuFit.html">emuFit</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="op">~</span> <span class="va">Group</span>, </span>
<span>                      data <span class="op">=</span> <span class="va">wirbel_sample</span><span class="op">[</span><span class="va">ch_study_obs</span>, <span class="op">]</span>,</span>
<span>                      Y <span class="op">=</span> <span class="va">small_Y</span>,</span>
<span>                      constraint_fn <span class="op">=</span> <span class="va">ref_taxon</span>, </span>
<span>                      fitted_model <span class="op">=</span> <span class="va">ch_fit_ref</span>, <span class="co"># provide our previous fit</span></span>
<span>                      refit <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># avoid refitting model</span></span>
<span>                      <span class="co"># test the first taxon, F. nucleatum s. vincentii</span></span>
<span>                      test_kj <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>j <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                      <span class="co"># test the second column in the design matrix</span></span>
<span>                      <span class="co"># associated with the case/control covariate</span></span>
<span>                                           k <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<p>Now let’s look at the results.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ch_test_ref</span><span class="op">$</span><span class="va">coef</span><span class="op">)</span></span>
<span><span class="co">#&gt;   covariate                                                category</span></span>
<span><span class="co">#&gt; 1  GroupCRC Fusobacterium nucleatum s. vincentii [ref_mOTU_v2_0754]</span></span>
<span><span class="co">#&gt; 2  GroupCRC  Fusobacterium nucleatum s. animalis [ref_mOTU_v2_0776]</span></span>
<span><span class="co">#&gt; 3  GroupCRC Fusobacterium nucleatum s. nucleatum [ref_mOTU_v2_0777]</span></span>
<span><span class="co">#&gt; 4  GroupCRC         Faecalibacterium prausnitzii [ref_mOTU_v2_1379]</span></span>
<span><span class="co">#&gt; 5  GroupCRC                  Eubacterium siraeum [ref_mOTU_v2_1387]</span></span>
<span><span class="co">#&gt; 6  GroupCRC                      Eubacterium sp. [ref_mOTU_v2_1395]</span></span>
<span><span class="co">#&gt;   category_num   estimate        se     lower       upper score_stat      pval</span></span>
<span><span class="co">#&gt; 1            1 -0.8267924 0.4581980 -1.724844  0.07125911   1.109799 0.2921257</span></span>
<span><span class="co">#&gt; 2            2  0.0000000 0.0000000  0.000000  0.00000000         NA        NA</span></span>
<span><span class="co">#&gt; 3            3  0.7732337 0.6760617 -0.551823  2.09829032         NA        NA</span></span>
<span><span class="co">#&gt; 4            4 -2.6562468 0.8743699 -4.369980 -0.94251329         NA        NA</span></span>
<span><span class="co">#&gt; 5            5 -2.2742501 1.0331042 -4.299097 -0.24940312         NA        NA</span></span>
<span><span class="co">#&gt; 6            6 -1.1836475 1.1805958 -3.497573  1.13027766         NA        NA</span></span></code></pre></div>
<p>Here, the p-value is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.292</mn><annotation encoding="application/x-tex">0.292</annotation></semantics></math>.
Therefore, we fail to reject the null hypothesis that the expected log
fold-difference in the abundance of <em>F. nucleatum s. vincentii</em>
in cases compared to controls is equal to the expected log
fold-difference in the abundance of <em>F. nucleatum s. animalis</em> in
cases compared to controls. We do not have sufficient evidence to
support the conclusion that <em>F. nucleatum s. vincentii</em> and
<em>F. nucleatum s. animalis</em> have significantly different
fold-differences in abundances of cases compared to controls.</p>
<p><strong>Important</strong>: These hypothesis tests are testing
different hypotheses!!! So, they <strong>should</strong> give different
results. Phew.</p>
<p>Note that while this example uses a model with a single categorical
covariate, you can follow the same approach with multiple covariates as
well as cluster-correlated (e.g. longitudinal) data. Don’t forget that
your parameter interpretations change when you adjust for multiple
covariates!</p>
<p>We hope you found this example helpful!! If you have any questions,
feel free to post an <a href="https://github.com/statdivlab/radEmu/issues" class="external-link">issue</a> to let us
know!</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by David Clausen, Amy Willis, Sarah Teichman.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
